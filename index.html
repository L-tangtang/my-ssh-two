<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" href="./scss/index.css">
    <link rel="stylesheet" href="./js/iconfont/iconfont.css">
    <link rel="stylesheet" href="./js/swiper.css">
    <script src="./js/flexible.js"></script>
</head>

<body>
    <div class="wrap">
        <header class="header">
            <span>演出</span>
            <span><img src="./img/6.jpg" alt=""></span>
        </header>
        <div class="nav-box">
            <span>北京</span>
            <span><a href="city.html"><input type="text" placeholder="找艺人、演出、场馆"></a><b
                    class='iconfont'>&#xe614;</b></span>
        </div>
        <main class="main">
            <div class="content" data-top='下拉刷新' data-bottom='上啦加载'>

                <div class='loading-box'>
                    <div class="loading"></div>
                    <div class="loading"></div>
                    <div class="loading"></div>
                    <div class="loading"></div>
                </div>

                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <!-- <div class="swiper-slide">
                            <img src="./img/7.jpg" alt="">
                        </div> -->
                        <div class="swiper-slide">
                            <img src="./img/2.jpg" alt="">
                        </div>
                        <div class="swiper-slide">
                            <img src="./img/3.jpg" alt="">
                        </div>
                        <div class="swiper-slide">
                            <img src="./img/4.jpg" alt="">
                        </div>
                        <div class="swiper-slide">
                            <img src="./img/5.jpg" alt="">
                        </div>
                    </div>

                    <div class="swiper-pagination"></div>
                </div>

                <div class="icon-box">
                    <ul>
                        <li><img src="./img/14.jpg" alt=""></li>
                        <li>演唱会</li>
                    </ul>
                    <ul>
                        <li><img src="./img/15.jpg" alt=""></li>
                        <li>话剧歌剧</li>
                    </ul>
                    <ul>
                        <li><img src="./img/11.jpg" alt=""></li>
                        <li>休闲展览</li>
                    </ul>
                    <ul>
                        <li><img src="./img/8.jpg" alt=""></li>
                        <li>亲子演出</li>
                    </ul>
                    <ul>
                        <li><img src="./img/10.jpg" alt=""></li>
                        <li>戏曲艺术</li>
                    </ul>
                    <ul>
                        <li><img src="./img/17.jpg" alt=""></li>
                        <li>音乐会</li>
                    </ul>
                    <ul>
                        <li><img src="./img/16.jpg" alt=""></li>
                        <li>舞蹈芭蕾</li>
                    </ul>
                    <ul>
                        <li><img src="./img/9.jpg" alt=""></li>
                        <li>开心麻花</li>
                    </ul>
                    <ul>
                        <li><img src="./img/12.jpg" alt=""></li>
                        <li>景点/门票</li>
                    </ul>
                    <ul>
                        <li><img src="./img/13.jpg" alt=""></li>
                        <li>更多精彩</li>
                    </ul>
                </div>

                <div class="img-box">
                    <img src="./img/18.jpg" alt="">
                </div>

                <h4>-发现精彩-</h4>
                <div class='content-box'>
                    <span>
                        <img src="./img/19.jpg" alt="">
                    </span>
                    <span>
                        <img src="./img/20.jpg" alt="">
                    </span>
                </div>

                <div class='box-box'>
                    <dl>
                        <dt>鹿晗</dt>
                        <dd><span>北京演唱会</span></dd>
                        <dd><img src="./img/icon3.png" alt=""></dd>
                    </dl>
                    <dl>
                        <dt>深夜食堂</dt>
                        <dd><span>授权音乐剧</span></dd>
                        <dd><img src="./img/icon8.png" alt=""></dd>
                    </dl>
                    <dl>
                        <dt>冰上迪士尼</dt>
                        <dd><span>花样滑冰秀</span></dd>
                        <dd><img src="./img/icon9.png" alt=""></dd>
                    </dl>
                </div>

                <div class='nav'>
                    <ul>
                        <li class='active'>当前热门</li>
                        <li>最新上架</li>
                        <li>折扣演出</li>
                        <li>全部时间</li>
                    </ul>
                </div>

                <div class='dl-box'>
                    <!-- <dl>
                        <dt><img src="./img/4.jpg" alt=""></dt>
                        <dd>
                            <h3>新壶中天·桃园篇-首都东方文化</h3>
                            <p>2018-08-23至2018-11-08</p>
                            <p>北京 新壶中天</p>
                            <p>60-288元</p>
                        </dd>
                        <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                    </dl>
                    <dl>
                        <dt><img src="./img/3.jpg" alt=""></dt>
                        <dd>
                            <h3>新壶中天·桃园篇-首都东方文化</h3>
                            <p>2018-08-23至2018-11-08</p>
                            <p>北京 新壶中天</p>
                            <p>60-288元</p>
                        </dd>
                        <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                    </dl>
                    <dl>
                        <dt><img src="./img/2.jpg" alt=""></dt>
                        <dd>
                            <h3>新壶中天·桃园篇-首都东方文化</h3>
                            <p>2018-08-23至2018-11-08</p>
                            <p>北京 新壶中天</p>
                            <p>60-288元</p>
                        </dd>
                        <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                    </dl> -->
                </div>


                <div class="circle">
                    <div class="box"></div>
                    <div class="box"></div>
                    <div class="box"></div>
                    <div class="box"></div>
                </div>
            </div>
        </main>
        <div class='btn'>
            <span>点击回到顶部</span>
        </div>
        <footer class="footer">
            <ul>
                <li class='iconfont'>&#xe717;</li>
                <li>电影</li>
            </ul>
            <ul>
                <li class='iconfont'>&#xe717;</li>
                <li>影院</li>
            </ul>
            <ul>
                <li class='iconfont'>&#xe717;</li>
                <li>演出</li>
            </ul>
            <ul>
                <li class='iconfont'>&#xe717;</li>
                <li>赛事</li>
            </ul>
            <ul>
                <li class='iconfont'>&#xe617;</li>
                <li>我的</li>
            </ul>
        </footer>
    </div>

    <script src="./js/bscroll.js"></script>
    <script src="./js/swiper.js"></script>
    <script src="./js/ajax.js"></script>

    <script>
        var myBscroll = new Swiper('.swiper-container', {
            // scrollX: true
            pagination: {
                el: '.swiper-pagination',
                type: 'bullets', // fraction  progressbar  custom  bullets
            },
        })
    </script>

    <script>
        var BS = function (opt) {
            Object.assign(this, opt);
            this.content = document.querySelector('.content .dl-box');
            this.cont = document.querySelector('.content');
            this.lis = document.querySelectorAll('.nav ul li');
            this.ul = document.querySelector('.nav ul');
            this.tabBox = document.querySelector('.nav');
            this.main = document.querySelector('.main');
            this.btn = document.querySelector('.btn');
            console.log(this.btn)
            this.init();
        }
        BS.prototype = {
            constructor: BS,
            init: function () {
                ajax('./moke/data.json', (list) => {
                    this.rander(list, 'top')
                })
                this.bsFn();

                this.addEvent();

                // this.fixedFn();

                this.clickBtn();
            },

            //上啦加载 下拉刷新
            bsFn: function () {
                this.myBS = new BScroll('.main', {
                    click: true,
                    pullDownRefresh: {
                        threshold: 180,
                        stop: 80
                    },
                    pullUpLoad: {
                        threshold: -100
                    }
                })

                this.myBS.on('pullingDown', () => {
                    this.cont.dataset.top = '正在刷新';
                    ajax('./moke/data.json', (list) => {
                        setTimeout(() => {
                            this.rander(list, 'top');
                            this.cont.dataset.top = '下拉刷新';
                            this.myBS.finishPullDown();
                            this.myBS.refresh();
                        }, 2000)
                    })
                })

                this.myBS.on('pullingUp', () => {
                    this.cont.dataset.bottom = '正在加载';
                    ajax('./moke/data.json', (list) => {
                        setTimeout(() => {
                            this.rander(list, 'bottom');
                            this.cont.dataset.bottom = '上啦加载';
                            this.myBS.finishPullUp();
                            this.myBS.refresh();
                        }, 2000)
                    })
                })
            },

            //渲染函数
            rander: function (data, dir) {
                var list = data.map(item => {
                    return ` <dl>
                                <dt><img src="${item.img}" alt=""></dt>
                                <dd>
                                    <h3>${item.title}</h3>
                                    <p>${item.time}</p>
                                    <p>${item.dir}</p>
                                    <p>${item.price}元</p>
                                </dd>
                                <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                            </dl>`
                }).join('');

                switch (dir) {
                    case 'top':
                        this.content.innerHTML = list;
                        break;
                    case 'bottom':
                        this.content.innerHTML += list;
                        break;
                }

                this.circle();
            },

            //canvas函数
            circle: function () {
                this.myCanvas = document.querySelectorAll('.myCanvas');
                this.myCanvas.forEach(item => {
                    this.api = item.getContext('2d');
                    this.api.beginPath();
                    this.api.arc(item.width / 2, item.height / 2, 50, 0, Math.PI * 2);
                    this.api.lineWidth = 10;
                    this.api.strokeStyle = 'red';
                    this.api.stroke();
                })
            },
            //点击事件
            addEvent: function () {
                this.content.innerHTML = '';
                this.lis.forEach((item, index) => {

                    item.onclick = () => {

                        // for (var i = 0; i < this.lis.length; i++) {
                        //     this.lis[i].classList.remove('active')
                        // }
                        if (this.ul.querySelector('.active')) {
                            this.ul.querySelector('.active').classList.remove('active');
                        }
                        item.classList.add('active');
                        this.randerFn(index)
                    }
                })
            },

            //tab切换
            randerFn: function (ind) {
                ajax('./moke/data.json', (list) => {
                    this.content.innerHTML = list.map((item) => {
                        if (ind === 0 && item.boole) {
                            return `<dl>
                                                <dt><img src="${item.img}" alt=""></dt>
                                                <dd>
                                                    <h3>${item.title}</h3>
                                                    <p>${item.time}</p>
                                                    <p>${item.dir}</p>
                                                    <p>${item.price}元</p>
                                                </dd>
                                                <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                                            </dl>`
                        } else if (ind === 1 && item.boole === false) {
                            return `<dl>
                                                <dt><img src="${item.img}" alt=""></dt>
                                                <dd>
                                                    <h3>${item.title}</h3>
                                                    <p>${item.time}</p>
                                                    <p>${item.dir}</p>
                                                    <p>${item.price}元</p>
                                                </dd>
                                                <dd><canvas class='myCanvas' width='150' height='150'></canvas></dd>
                                            </dl>`
                        }
                    }).join('')
                })
            },

            //回到顶部
            clickBtn: function () {
                this.btn.onclick = () => {
                    this.myBS.scrollToElement('header', 2000);
                }
            }

        }
        new BS()
    </script>
</body>

</html>